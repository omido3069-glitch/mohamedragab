<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª â€” Ø¬Ø§Ù…Ø¹Ø© Ø­Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ù‡Ù„ÙŠØ©</title>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <style>
    :root{
      --blue-dark: #0d47a1;
      --blue-soft: #e7f3ff;
      --card-blue: #d8eefe;
      --accent: #1976d2;
      --black-bold: #0b0b0b;
      --danger: #d32f2f;
      --green: #2e7d32;
    }

    html,body{height:100%;margin:0}
    body{
      font-family:'Cairo',sans-serif;
      background: linear-gradient(180deg,#f8fbff 0%, #e9f7ff 100%);
      color: var(--black-bold);
      -webkit-font-smoothing:antialiased;
      -moz-osx-osx-smoothing:grayscale;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:14px;
    }

    /* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
    .title {
      color: var(--blue-dark);
      font-size:24px; /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø­Ø¬Ù… */
      font-weight:900; /* Ø²ÙŠØ§Ø¯Ø© Ø³Ù…Ùƒ Ø§Ù„Ø®Ø· */
      text-align:center;
      margin-top:10px; /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø¹Ù„ÙˆÙŠ */
      margin-bottom:4px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø³ÙÙ„ÙŠ Ù„ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„ØªØ°ÙŠÙŠÙ„ */
      letter-spacing: 0.5px; /* Ø¥Ø¶Ø§ÙØ© ØªØ¨Ø§Ø¹Ø¯ Ø¨Ø³ÙŠØ· Ù„Ù„Ø­Ø±ÙˆÙ */
      text-shadow: 0 1px 2px rgba(0,0,0,0.05); /* Ø¥Ø¶Ø§ÙØ© Ø¸Ù„ Ø®ÙÙŠÙ */
    }

    /* Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© (Ø£Ø²Ø±Ù‚ Ø«Ø§Ø¨Øª Ù„ÙƒÙ† Ø§Ù„Ù†Øµ ÙŠØªØºÙŠØ±) â€” Ù…ØªØ­Ø±Ùƒ Ù…Ù† Ø§Ù„ÙŠÙ…ÙŠÙ† Ù„Ù„ÙŠØ³Ø§Ø± */
    .status-wrap{
      width:100%;
      max-width:520px;
      overflow:hidden;
      border-radius:10px;
      margin-bottom:12px;
      background:linear-gradient(90deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
      border:1px solid rgba(13,71,161,0.06);
    }
    .status {
      display:block;
      white-space:nowrap;
      padding:8px 12px;
      font-weight:700;
      color:var(--black-bold);
      background: linear-gradient(90deg, rgba(235,246,255,0.6), rgba(255,255,255,0));
      transform:translateX(100%);
      animation: slideRTL 8s linear infinite;
      font-size:14px;
    }
    @keyframes slideRTL {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }

    /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ */
    .card {
      width:100%;
      max-width:520px;
      background:#fff;
      border-radius:14px;
      padding:14px;
      box-shadow:0 8px 30px rgba(13,71,161,0.06);
      margin-bottom:12px;
      box-sizing:border-box;
    }

    label{
      display:block;
      text-align:right;
      margin:8px 0 6px;
      font-weight:800;
      color:var(--black-bold);
      font-size:15px;
    }

    /* Ø§Ù„Ø­Ù‚ÙˆÙ„ - Ù…Ø±Ø¨Ø¹Ø§Øª Ù…Ù„ÙˆÙ†Ø© */
    .input {
      width:100%;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid #d6eaf8;
      background: var(--card-blue);
      text-align:center;
      font-size:16px;
      font-weight:700;
      color:var(--black-bold);
      outline:none;
      box-sizing:border-box;
    }
    .input:focus{
      box-shadow:0 6px 18px rgba(33,150,243,0.12);
      border-color:var(--accent);
      background:#eef8ff;
    }

    textarea.input {
      min-height:60px;
      resize:vertical;
      padding-top:10px;
    }

    .row {
      display:flex;
      gap:10px;
      align-items:center;
    }
    
    /* Ø¥Ø¶Ø§ÙØ© ØªÙ†Ø³ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯ Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© */
    .filter-bar {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
        width: 100%;
        max-width: 520px;
    }
    .filter-bar .input {
        padding: 8px 10px;
        font-size: 14px;
        font-weight: 600;
        height: 40px; /* Ù„ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ */
    }
    .filter-bar select.input {
        flex-shrink: 0; /* Ù„Ù…Ù†Ø¹ ØªÙ‚Ù„Øµ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØµÙÙŠØ© */
        width: 140px;
        text-align: right; /* Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù†Øµ Ù„Ù„ÙŠÙ…ÙŠÙ† */
        padding-right: 14px; /* Ù…Ø³Ø§ÙØ© Ø¯Ø§Ø®Ù„ÙŠØ© Ù„Ù„ÙŠÙ…ÙŠÙ† */
    }
    .filter-bar .input[type="text"] {
        flex-grow: 1; /* Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø£Ø®Ø° Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© */
    }


    /* Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ */
    .btn-primary {
      margin-top:12px;
      width:100%;
      padding:12px;
      border-radius:12px;
      border:none;
      background: linear-gradient(90deg,#1565c0,#42a5f5);
      color:white;
      font-weight:800;
      font-size:16px;
      cursor:pointer;
      transition:opacity 0.3s ease;
    }
    .btn-primary:active{transform:scale(.995)}
    .btn-primary:disabled{opacity:.6;cursor:not-allowed}
    
    /* Ø²Ø± Ø«Ø§Ù†ÙˆÙŠ */
    .btn-secondary {
        display: block;
        width: 100%;
        text-align: center;
        padding: 8px;
        border-radius: 12px;
        border: 1px solid var(--accent);
        background: #fff;
        color: var(--accent);
        font-weight: 800;
        font-size: 15px;
        cursor: pointer;
        transition: background 0.3s ease;
        text-decoration: none;
        box-sizing: border-box;
    }
    .btn-secondary:hover {
        background: var(--blue-soft);
    }


    /* Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª â€” Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ø³ØªÙ‚Ù„Ø© */
    .suggestions {
      margin-top:8px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      justify-content:flex-start;
    }
    .suggestion-card{
      background: linear-gradient(180deg,#e8f6ff, #d7efff);
      border-radius:12px;
      padding:10px 12px;
      min-width:96px;
      text-align:center;
      font-weight:800;
      color:var(--blue-dark);
      cursor:pointer;
      box-sizing:border-box;
      border:1px solid rgba(13,71,161,0.06);
      transition:transform .12s ease, box-shadow .12s ease;
    }
    .suggestion-card:hover{ transform:translateY(-4px); box-shadow:0 8px 20px rgba(13,71,161,0.08) }

    /* Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªÙ…Ø±ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„) */
    .table-wrap{
      width:100%;
      max-width:520px;
      background:#fff;
      border-radius:12px;
      overflow:auto;
      box-shadow:0 8px 20px rgba(13,71,161,0.04);
      margin-top:10px;
    }
      table {
      width:100%;
      border-collapse:collapse;
      /* ØªÙ… Ø¥Ø²Ø§Ù„Ø© min-width: 700px Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø§Ù„ØªÙƒÙŠÙ Ù…Ø¹ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø´Ø§Ø´Ø© */
    }
    th, td{
      padding:8px; 
      text-align:center;
      /* ØªÙ… Ø²ÙŠØ§Ø¯Ø© Ø³Ù…Ùƒ ÙˆØºÙ…Ù‚ Ù„ÙˆÙ† Ø§Ù„Ø®Ø· Ø§Ù„ÙØ§ØµÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø³Ø¬Ù„Ø§Øª */
      border-bottom:2px solid #ccddee; 
      font-weight:700;
      color:var(--black-bold);
      font-size:10px; 
    }
    th{
      background:var(--accent);
      color:#fff;
      font-size:9px; 
      font-weight:800;
    }
    .time-in{ color:var(--green) }
    .time-out{ color:var(--danger) }

    .exit-btn{
      background:var(--danger);
      color:#fff;
      border:none;
      padding:4px 6px; 
      border-radius:6px;
      font-weight:800;
      font-size:10px; 
      cursor:pointer;
      transition:opacity 0.3s ease;
    }
    .exit-btn:disabled{
      opacity:.6;
      cursor:not-allowed;
    }

    /* footer */
    .footer { 
      margin-top:6px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø¹Ù„ÙˆÙŠ Ù„ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„ØªØ°ÙŠÙŠÙ„ Ù…Ù† Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
      color: #999; /* Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ Ø£ÙØªØ­ ÙˆØ£ÙƒØ«Ø± Ù‡Ø¯ÙˆØ¡Ù‹Ø§ */
      font-weight: 600; /* Ø®Ø· Ø£Ù‚Ù„ Ø³Ù…ÙƒÙ‹Ø§ */
      font-size: 12px; /* Ø­Ø¬Ù… Ø£ØµØºØ± */
      text-align: center;
      padding-bottom: 10px; /* Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§Ø­Ø© Ø³ÙÙ„ÙŠØ© */
    }

    /* Loader text */
    .loading-text {
      display:inline-block;
      font-weight:800;
      color:var(--blue-dark);
      margin-left:8px;
    }
    .pulse {
      display:inline-block;
      width:8px;height:8px;border-radius:50%;
      background:var(--blue-dark); margin-left:6px;
      animation:pulse 1s infinite;
    }
    @keyframes pulse { 0%{opacity:1}50%{opacity:.3}100%{opacity:1} }

    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 16px;
      border-radius: 8px;
      font-weight: 700;
      font-size: 14px;
      animation: slideIn 0.3s ease;
      z-index: 1000;
    }
    .notification.success {
      background: #4caf50;
      color: white;
    }
    .notification.error {
      background: #f44336;
      color: white;
    }
    /* Ø¥Ø¶Ø§ÙØ© Ù„ÙˆÙ† ØªØ­Ø°ÙŠØ±ÙŠ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…ÙŠØ²Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
    .notification.warning {
        background: #ff9800; /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */
        color: var(--black-bold);
    }

    @keyframes slideIn {
      from { transform: translateX(400px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .notification.fade-out {
        animation: fadeOut 0.5s ease-out forwards;
    }

    @keyframes fadeOut {
        from { opacity: 1; transform: translateX(0); }
        to { opacity: 0; transform: translateX(400px); }
    }
    
    /* ÙØ§ØµÙ„ Ø§Ù„Ø£ÙŠØ§Ù… ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
    .day-separator td {
      background: var(--blue-soft);
      color: var(--blue-dark);
      font-weight: 800;
      text-align: center;
      padding: 6px; 
      /* Ø²ÙŠØ§Ø¯Ø© Ø³Ù…Ùƒ ÙˆÙˆØ¶ÙˆØ­ Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ø¹Ù„ÙˆÙŠØ© ÙˆØ§Ù„Ø³ÙÙ„ÙŠØ© Ù„Ù„ÙØ§ØµÙ„ */
      border-bottom: 3px solid var(--accent);
      border-top: 3px solid var(--accent);
      font-size: 11px; 
    }

    /* responsive adjustments */
    @media (max-width:420px){
      .title{ font-size:18px }
      .card{ padding:12px }
      .input{ font-size:15px; padding:10px }
      .btn-primary{ padding:10px; font-size:15px }
      th,td{ padding:4px; font-size:9px } 
      .suggestion-card{ min-width:86px; padding:8px 10px; font-size:13px }
    }
  </style>
</head>
<body>

  <div style="width:100%;max-width:520px;">
    <div class="title">ğŸš— Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª â€” Ø¬Ø§Ù…Ø¹Ø© Ø­Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ù‡Ù„ÙŠØ©</div>

    <div class="footer">ØªÙ… Ø§Ù„ØªØµÙ…ÙŠÙ… Ø¨ÙˆØ§Ø³Ø·Ø© / Ù…Ø­Ù…Ø¯ Ø±Ø¬Ø¨</div>

    <div class="status-wrap" aria-hidden="true">
      <span id="status" class="status">âœ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ (Ø¨Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª)</span>
    </div>
    
    <!-- ********************************************** -->
    <!-- Ø²Ø± Ø±ÙØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø§ÙˆÙ† Ù„Ø§ÙŠÙ† -->
    <!-- ********************************************** -->
    <div class="card" id="uploadCard">
        <button id="uploadBtn" class="btn-secondary">â¬†ï¸ Ø±ÙØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø§ÙˆÙ† Ù„Ø§ÙŠÙ†</button>
    </div>
    <!-- ********************************************** -->
    
    <div class="card">
      <label for="carNumber">Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©</label>
      <input id="carNumber" class="input" placeholder="Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø© (Ø§ÙƒØªØ¨ Ø£ÙˆÙ„ Ø±Ù‚Ù…ÙŠÙ† Ù„ØªØ¸Ù‡Ø± Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª)" autocomplete="off" />

      <div id="suggestions" class="suggestions" aria-live="polite"></div>

      <label for="name">Ø§Ù„Ø§Ø³Ù…</label>
		      <input id="name" class="input" placeholder="Ø§Ù„Ø§Ø³Ù…" />

      <label for="college">Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„</label>
		      <input id="college" class="input" placeholder="Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„" />

      <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
      <textarea id="notes" class="input" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>

      <button id="loginBtn" class="btn-primary">â• ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>

      <div id="loadingRow" style="margin-top:10px;display:none;">
        <span class="loading-text">Ø¬Ø§Ø±Ù Ø¬Ù„Ø¨ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</span><span class="pulse" aria-hidden="true"></span>
      </div>
    </div>
    
    <!-- ********************************************** -->
    <!-- Ø¥Ø¶Ø§ÙØ© Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØµÙÙŠØ© ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
    <!-- ********************************************** -->
    <div class="filter-bar">
        <!-- ÙÙ„ØªØ± Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ… -->
        <select id="filterDate" class="input" title="ÙÙ„ØªØ± Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ…">
            <option value="">ÙƒÙ„ Ø§Ù„Ø£ÙŠØ§Ù…</option>
        </select>
        
        <!-- Ø®Ø§Ù†Ø© Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
        <input type="text" id="searchQuery" class="input" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©" title="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©">
    </div>
    <!-- ********************************************** -->

    <div class="table-wrap" style="margin-top:12px;">
      <table id="recordsTable" aria-live="polite">
        <thead>
          <tr>
            <th>Ø§Ù„Ø§Ø³Ù…</th>
            <th>Ø±Ù‚Ù…</th>
            <th>Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
            <th>ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
            <th>ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬</th>
            <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
            <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
          </tr>
        </thead>
        <tbody id="recordsBody"></tbody>
      </table>
    </div>

  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getDatabase, ref, get, child, set // Ø¥Ø¶Ø§ÙØ© set Ù„Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // ====== Ø¥Ø¹Ø¯Ø§Ø¯ Firebase (Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø·) ======
    // Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØ¬Ø¨ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙŠÙ… Ø¨Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø© ÙÙŠ Ø§Ù„Ø¥Ù†ØªØ§Ø¬
    const firebaseConfig = {
      apiKey: "AIzaSyCRR-uXoz14YOudO0K740Y5AUbivB0R5M0",
      authDomain: "hnu-3069.firebaseapp.com",
      databaseURL: "https://hnu-3069-default-rtdb.firebaseio.com",
      projectId: "hnu-3069",
      storageBucket: "hnu-3069.firebasestorage.app",
      messagingSenderId: "98084688599",
      appId: "1:98084688599:web:e272972e76d63f8ae01692",
      measurementId: "G-P0E5EC7CHJ"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const dbRef = ref(db);

    // ====== Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙÙŠ DOM ======
    const carNumberInput = document.getElementById('carNumber');
    const nameInput = document.getElementById('name');
    const collegeInput = document.getElementById('college');
    const notesInput = document.getElementById('notes');
    const loginBtn = document.getElementById('loginBtn');
    const suggestionsWrap = document.getElementById('suggestions');
    const recordsBody = document.getElementById('recordsBody');
    const statusSpan = document.getElementById('status');
    
    // **********************************************
    // Ø¥Ø¶Ø§ÙØ© Ø¹Ù†Ø§ØµØ± DOM Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    // **********************************************
    const filterDateInput = document.getElementById('filterDate');
    const searchQueryInput = document.getElementById('searchQuery');
    const uploadBtn = document.getElementById('uploadBtn'); // Ø²Ø± Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯
    // **********************************************

    // ====== ÙˆØ¸ÙŠÙØ© Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØµÙÙŠØ© Ø¨Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ======
    function populateDateFilter() {
        // Ø¬Ù…Ø¹ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„ÙØ±ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§Øª
        const uniqueDates = [...new Set(recordsCache.map(rec => formatDate(rec.timestamp)))];
        
        // ÙØ±Ø² Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ù„Ù„Ø£Ù‚Ø¯Ù…
        uniqueDates.sort((a, b) => new Date(b) - new Date(a));
        
        // Ù…Ø³Ø­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆØ¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø± "ÙƒÙ„ Ø§Ù„Ø£ÙŠØ§Ù…"
        filterDateInput.innerHTML = '<option value="">ÙƒÙ„ Ø§Ù„Ø£ÙŠØ§Ù…</option>';
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        uniqueDates.forEach(date => {
            const option = document.createElement('option');
            option.value = date;
            
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¥Ù„Ù‰ ØµÙŠØºØ© Ø¹Ø±Ø¨ÙŠØ© (Ù…Ø«Ø§Ù„: Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡ØŒ 15 Ù…Ø§ÙŠÙˆ 2024)
            const formattedDate = new Date(date).toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            option.textContent = formattedDate;
            
            filterDateInput.appendChild(option);
        });
    }

    // ====== Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª ======
    let carsCache = []; // Ù„ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ù…Ù† Firebase
    let recordsCache = []; // Ù„ØªØ®Ø²ÙŠÙ† Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Local Storage
    let filteredRecords = []; // Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„ØªØµÙÙŠØ© ÙˆØ§Ù„Ø¨Ø­Ø«
    
    // ====== ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© ======

    // Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± Ù…Ø¤Ù‚Øª
    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);

      setTimeout(() => {
        notification.classList.add('fade-out');
        notification.addEventListener('animationend', () => notification.remove());
      }, 3000);
    }

    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª Ø¥Ù„Ù‰ ØµÙŠØºØ© 12 Ø³Ø§Ø¹Ø© (Ù…Ø«Ø§Ù„: 10:30 Øµ)
    function formatTime(timestamp) {
      const date = new Date(timestamp);
      const hours = date.getHours();
      const minutes = date.getMinutes();
      const ampm = hours >= 12 ? 'Ù…' : 'Øµ';
      const formattedHours = hours % 12 || 12;
      const formattedMinutes = minutes < 10 ? '0' + minutes : minutes;
      return `${formattedHours}:${formattedMinutes} ${ampm}`;
    }

    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ® (Ù…Ø«Ø§Ù„: 2024-05-15)
    function formatDate(timestamp) {
        const date = new Date(timestamp);
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    // ====== ÙˆØ¸Ø§Ø¦Ù Local Storage ======

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù…Ù† Local Storage
    function loadRecordsFromLocalStorage() {
      const records = localStorage.getItem('carRecords');
      recordsCache = records ? JSON.parse(records) : [];
      // Ø§Ù„ÙØ±Ø² Ø­Ø³Ø¨ Ø£Ø­Ø¯Ø« Ø³Ø¬Ù„ (timestamp)
      recordsCache.sort((a, b) => b.timestamp - a.timestamp);
      
      // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØµÙÙŠØ© Ø¨Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
      populateDateFilter();
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
      applyFilters(); 
    }

    // Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ÙÙŠ Local Storage
    function saveRecordsToLocalStorage() {
      localStorage.setItem('carRecords', JSON.stringify(recordsCache));
    }

    // ====== Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase ======
    async function fetchCarsData() {
      statusSpan.textContent = 'â³ Ø¬Ø§Ø±Ù Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ù…Ù† Firebase...';
      try {
        const snapshot = await get(child(dbRef, 'cars'));
        if (snapshot.exists()) {
          // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙƒØ§Ø¦Ù† Ø¥Ù„Ù‰ Ù…ØµÙÙˆÙØ©
          carsCache = Object.values(snapshot.val());
          statusSpan.textContent = 'âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.';
        } else {
          statusSpan.textContent = 'âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø³ÙŠØ§Ø±Ø§Øª.';
        }
      } catch (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª:", error);
        statusSpan.textContent = 'âŒ ÙØ´Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ù‚Ø¯ ØªÙƒÙˆÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¯ÙŠÙ…Ø©.';
      }
    }
    
    // ====== Ø±ÙØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø¥Ù„Ù‰ Firebase ======
    async function uploadTodayRecords() {
        // 1. ØªØ­Ø¯ÙŠØ¯ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø°ÙŠ ÙŠØªÙ… ÙÙŠÙ‡ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±)
        const today = formatDate(Date.now());
        const recordsToUpload = recordsCache.filter(rec => formatDate(rec.timestamp) === today);
        
        if (recordsToUpload.length === 0) {
            showNotification('âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ø±ÙØ¹Ù‡Ø§.', 'warning');
            return;
        }
        
        // 2. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø±ÙØ¹ (ØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ø¥Ù„Ù‰ ÙƒØ§Ø¦Ù†)
        const recordsObject = recordsToUpload.reduce((obj, rec) => {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¹Ø±Ù Ø§Ù„ÙØ±ÙŠØ¯ (id) ÙƒØ³Ø¬Ù„ ÙÙŠ Firebase
            obj[rec.id] = rec;
            return obj;
        }, {});
        
        // 3. Ø§Ù„Ø±ÙØ¹ Ø¥Ù„Ù‰ Firebase
        uploadBtn.disabled = true;
        const originalText = uploadBtn.textContent;
        uploadBtn.textContent = `â³ Ø¬Ø§Ø±Ù Ø±ÙØ¹ ${recordsToUpload.length} Ø³Ø¬Ù„...`;
        
        try {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ø§Ù„Ø© set Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ­Øª Ù…Ø³Ø§Ø± Ø§Ù„ÙŠÙˆÙ…
            // Ø§Ù„Ù…Ø³Ø§Ø±: /records/YYYY-MM-DD
            const datePath = today.replace(/-/g, ''); // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ø·Ø§Øª Ù„ØªØµØ¨Ø­ 20240515
            const recordsRef = ref(db, `records/${datePath}`);
            await set(recordsRef, recordsObject);
            
            showNotification(`âœ… ØªÙ… Ø±ÙØ¹ ${recordsToUpload.length} Ø³Ø¬Ù„ Ù„Ù„ÙŠÙˆÙ… ${today} Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
        } catch (error) {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª:", error);
            showNotification('âŒ ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.', 'error');
        } finally {
            uploadBtn.disabled = false;
            uploadBtn.textContent = originalText;
        }
    }

    // **********************************************
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø­Ø¯Ø« Ù„Ø²Ø± Ø§Ù„Ø±ÙØ¹
    // **********************************************
    uploadBtn.addEventListener('click', uploadTodayRecords);
    // **********************************************
    
    // **********************************************
    // Ø¥Ø¶Ø§ÙØ© ÙˆØ¸ÙŠÙØ© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØµÙÙŠØ© ÙˆØ§Ù„Ø¨Ø­Ø«
    // **********************************************
    function applyFilters() {
        const selectedDate = filterDateInput.value; // Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø¯Ø¯ (Ø¨ØµÙŠØºØ© YYYY-MM-DD)
        const searchQuery = searchQueryInput.value.trim().toLowerCase(); // Ù†Øµ Ø§Ù„Ø¨Ø­Ø«
        
        filteredRecords = recordsCache.filter(rec => {
            let passesDateFilter = true;
            let passesSearchFilter = true;
            
            // 1. ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ…
            if (selectedDate) {
                const recordDate = formatDate(rec.timestamp);
                passesDateFilter = recordDate === selectedDate;
            }
            
            // 2. ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©
            if (searchQuery) {
                const name = (rec.name || '').toLowerCase();
                const number = (rec.number || '').toLowerCase();
                passesSearchFilter = name.includes(searchQuery) || number.includes(searchQuery);
            }
            
            return passesDateFilter && passesSearchFilter;
        });
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø©
        renderRecords();
    }
    
    // **********************************************
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØµÙÙŠØ© ÙˆØ§Ù„Ø¨Ø­Ø«
    // **********************************************
    // ØªÙ… ØªØºÙŠÙŠØ± 'change' Ø¥Ù„Ù‰ 'input' Ù„Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø«ØŒ ÙˆØªÙ… Ø§Ù„Ø¥Ø¨Ù‚Ø§Ø¡ Ø¹Ù„Ù‰ 'change' Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØµÙÙŠØ©
    filterDateInput.addEventListener('change', applyFilters);
    searchQueryInput.addEventListener('input', applyFilters);
    // **********************************************


    // ====== Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ (ØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… filteredRecords) ======
    function renderRecords() {
      recordsBody.innerHTML = '';
      let lastDate = '';

      // Ø§Ø³ØªØ®Ø¯Ø§Ù… filteredRecords Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† recordsCache
      filteredRecords.forEach(rec => {
        const currentDate = formatDate(rec.timestamp);

        // Ø¥Ø¶Ø§ÙØ© ÙØ§ØµÙ„ Ø§Ù„ÙŠÙˆÙ… Ø¥Ø°Ø§ ØªØºÙŠØ± Ø§Ù„ØªØ§Ø±ÙŠØ®
        if (currentDate !== lastDate) {
            const row = recordsBody.insertRow();
            row.className = 'day-separator';
            const cell = row.insertCell();
            cell.colSpan = 7;
            cell.textContent = new Date(rec.timestamp).toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            lastDate = currentDate;
        }

        const row = recordsBody.insertRow();
        
        // Ø§Ù„Ø§Ø³Ù…
        const nameCell = row.insertCell();
        nameCell.textContent = rec.name;

        // Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©
        const numberCell = row.insertCell();
        numberCell.textContent = rec.number;

        // Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
        const collegeCell = row.insertCell();
        collegeCell.textContent = rec.college;

        // ÙˆÙ‚Øª Ø§Ù„Ø¯Ø®ÙˆÙ„
        const inTimeCell = row.insertCell();
        inTimeCell.className = 'time-in';
        inTimeCell.textContent = rec.inTime;

        // ÙˆÙ‚Øª Ø§Ù„Ø®Ø±ÙˆØ¬
        const outTimeCell = row.insertCell();
        outTimeCell.className = rec.outTime ? 'time-out' : '';
        outTimeCell.textContent = rec.outTime || 'â€”';

        // Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
        const notesCell = row.insertCell();
        notesCell.textContent = rec.notes || 'â€”';

        // Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ (Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬)
        const actionCell = row.insertCell();
        if (!rec.outTime) {
          const exitBtn = document.createElement('button');
          exitBtn.className = 'exit-btn';
          exitBtn.textContent = 'Ø®Ø±ÙˆØ¬';
          exitBtn.setAttribute('data-id', rec.id);
          actionCell.appendChild(exitBtn);
        } else {
          actionCell.textContent = 'ØªÙ… Ø§Ù„Ø®Ø±ÙˆØ¬';
        }
      });
    }

    // ====== Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ ======
    async function loadInitialData() {
      await fetchCarsData();
      loadRecordsFromLocalStorage();
      // renderRecords() ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡Ø§ Ø¯Ø§Ø®Ù„ applyFilters Ø§Ù„ØªÙŠ ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡Ø§ Ø¯Ø§Ø®Ù„ loadRecordsFromLocalStorage
    }

    // ====== ÙˆØ¸ÙŠÙØ© Ø¹Ø±Ø¶ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ======
    function renderSuggestions(q) {
      suggestionsWrap.innerHTML = '';
      if (q.length < 2) return; // Ù„Ø§ ØªØ¹Ø±Ø¶ Ø´ÙŠØ¦Ù‹Ø§ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ø­Ø±ÙÙŠÙ†

      // Ø§Ø¨Ø­Ø« ÙÙŠ carsCache Ø¹Ù† numbers ØªØ­ØªÙˆÙŠ q
      const matches = carsCache.filter(c=> c.number && c.number.includes(q) );
      // Ø®Ø° Ø£ÙˆÙ„ 10 Ù†ØªÙŠØ¬Ø©
      matches.slice(0,10).forEach(c=>{
        const card = document.createElement('div');
        card.className = 'suggestion-card';
        // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: Ø¥Ø¸Ù‡Ø§Ø± Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ (college) Ù…Ø¹ Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©
        card.innerHTML = `<div style="font-size:13px;color:var(--blue-dark);">${c.number}</div><div style="font-size:12px;color:#0b0b0b;margin-top:4px">${c.name || ''}</div><div style="font-size:11px;color:#666;margin-top:2px">${c.college || ''}</div>`;
        card.addEventListener('click', ()=>{
          // Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± â€” Ø¹Ø¨Ù‘ÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„
          carNumberInput.value = c.number || '';
          nameInput.value = c.name || '';
          collegeInput.value = c.college || '';
          suggestionsWrap.innerHTML = '';
        });
        suggestionsWrap.appendChild(card);
      });

      // Ù„Ùˆ Ù…ÙÙŠØ´ Ù†ØªØ§Ø¦Ø¬ Ù†Ø¸Ù‡Ø± Ø±Ø³Ø§Ù„Ø© ØµØºÙŠØ±Ø©
      if(matches.length === 0){
        const no = document.createElement('div');
        no.style.color = '#666';
        no.style.fontWeight = '700';
        no.style.marginTop = '6px';
        no.textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©';
        suggestionsWrap.appendChild(no);
      }
    }

    // ====== Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ù‚Ù„ Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø© ======
    carNumberInput.addEventListener('input', (e)=>{
      renderSuggestions(e.target.value.trim());
    });

    // ====== Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø±Ù‚Ù… Ø£Ùˆ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø­Ù‚Ù„ ======
    carNumberInput.addEventListener('change', ()=>{
      const val = carNumberInput.value.trim();
      if(!val) return;
      const found = carsCache.find(c => c.number === val);
      if(found){
        nameInput.value = found.name || '';
        collegeInput.value = found.college || '';
      }
    });

    // ====== ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ â€” ÙŠØ®Ø²Ù† ÙÙŠ Local Storage ======
    loginBtn.addEventListener('click', async ()=>{
      const number = carNumberInput.value.trim();
      const name = nameInput.value.trim();
      const college = collegeInput.value.trim();
      const notes = notesInput.value.trim();

      if(!number || !name){
        showNotification('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø«Ù… Ø§Ø®ØªØ± Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ Ø£Ùˆ Ø§Ù…Ù„Ø£ Ø§Ù„Ø§Ø³Ù….', 'error');
        return;
      }

      // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù…Ø³Ø¬Ù„Ø© Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„ÙØ¹Ù„ (Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨)
      const isAlreadyIn = recordsCache.some(rec => 
        rec.number === number && !rec.outTime // Ù†ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù… ÙˆØ¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ÙˆÙ‚Øª Ø®Ø±ÙˆØ¬
      );

      if (isAlreadyIn) {
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø§Ù„ÙØ¹Ù„ØŒ Ù†ÙˆÙ‚Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ÙˆÙ†Ø¹Ø±Ø¶ Ø¥Ø´Ø¹Ø§Ø± ØªØ­Ø°ÙŠØ±ÙŠ Ø£Ù†ÙŠÙ‚
        // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¨ÙŠÙ‡ Ø£Ù†ÙŠÙ‚Ø©
        const existingRecord = recordsCache.find(rec => rec.number === number && !rec.outTime);
        const entryTime = existingRecord ? existingRecord.inTime : 'ÙˆÙ‚Øª ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
        const entryCollege = existingRecord ? existingRecord.college : 'Ø¬Ù‡Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©';
        
        showNotification(`âš ï¸ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø±Ù‚Ù… ${number} Ù…Ø³Ø¬Ù„Ø© Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„ÙØ¹Ù„! (Ø¬Ù‡Ø©: ${entryCollege}ØŒ ÙˆÙ‚Øª: ${entryTime})`, 'warning');
        return;
      }

      try {
        // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸
        loginBtn.disabled = true;
        loginBtn.textContent = 'â³ Ø¬Ø§Ø±Ù Ø§Ù„Ø­ÙØ¸...';

        // ÙˆÙ‚Øª Ø¨ØµÙŠØºØ© 12 Ø³Ø§Ø¹Ø© Ù„Ø¹Ø±Ø¶ØŒ Ùˆtimestamp Ù„Ù„ÙØ±Ø²
        const ts = Date.now();
        const inTime = formatTime(ts);
        const id = 'rec_' + ts; // Ù…Ø¹Ø±Ù‘Ù ÙØ±ÙŠØ¯

        // Ø­ÙØ¸ ÙÙŠ Local Storage
        recordsCache.push({ id, name, number, college, notes, inTime, outTime:'', timestamp:ts });
        saveRecordsToLocalStorage();
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ± Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
        applyFilters(); 

        // Ù†Ø¸Ù Ø§Ù„Ø­Ù‚ÙˆÙ„
        carNumberInput.value = '';
        nameInput.value = '';
        collegeInput.value = '';
        notesInput.value = '';
        suggestionsWrap.innerHTML = '';

        showNotification('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
      } catch(err){
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸', err);
        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„', 'error');
      } finally {
        // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø²Ø±
        loginBtn.disabled = false;
        loginBtn.textContent = 'â• ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„';
      }
    });

    // ====== ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ â€” ÙŠØ­Ø¯Ø« outTime ÙÙŠ Local Storage ======
    recordsBody.addEventListener('click', async (e)=>{
      if(e.target && e.target.classList.contains('exit-btn')){
        const id = e.target.getAttribute('data-id');
        const ts = Date.now();
        const outTime = formatTime(ts);

        try{
          // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸
          e.target.disabled = true;
          e.target.textContent = 'â³...';

          // ØªØ­Ø¯ÙŠØ« ÙÙŠ Local Storage
          const rec = recordsCache.find(r=> r.id === id);
          if(rec){ 
            rec.outTime = outTime; 
            rec.outTimestamp = ts; 
          }
          saveRecordsToLocalStorage();

          // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
          applyFilters();

          showNotification('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        } catch(err){
          console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø±ÙˆØ¬', err);
          showNotification('ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'error');
          e.target.disabled = false;
          e.target.textContent = 'Ø®Ø±ÙˆØ¬';
        }
      }
    });

    // ====== Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© ======
    loadInitialData();
  </script>
</body>
</html>
