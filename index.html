<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة السيارات - إضافة مركبة</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --royal-blue: rgba(16, 28, 60, 0.95);
            --gold: #ffcc00;
            --cyan: #00f2ff;
            --magenta: #ff00e1;
            --label-text: #b0c4de;
        }

        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; }

        body {
            margin: 0; padding: 15px 10px; display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; background: linear-gradient(45deg, #ff9a9e, #fad0c4, #a1c4fd, #c2e9fb);
            background-size: 400% 400%; animation: vibrantFlow 12s ease infinite; overflow-x: hidden;
        }

        @keyframes vibrantFlow { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        /* شاشة التحميل */
        #loader-wrapper {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--royal-blue); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 9999;
            transition: opacity 0.8s ease, visibility 0.8s;
        }
        .loader-spinner { width: 50px; height: 50px; border: 5px solid rgba(255, 255, 255, 0.1); border-top-color: var(--gold); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loaded #loader-wrapper { opacity: 0; visibility: hidden; }

        /* محتوى الصفحة */
        #main-content { opacity: 0; transform: translateY(20px); transition: all 1s ease; width: 100%; display: flex; flex-direction: column; align-items: center; }
        .loaded #main-content { opacity: 1; transform: translateY(0); }

        /* منطقة البحث والأيقونة */
        .search-area { display: flex; align-items: center; gap: 10px; width: 100%; max-width: 350px; margin-bottom: 25px; }
        .search-box { 
            flex: 1; background: var(--royal-blue); border-radius: 12px; 
            box-shadow: 0 8px 25px rgba(16, 28, 60, 0.3); border: 1px solid rgba(255, 255, 255, 0.1); 
        }
        .search-box input { width: 100%; padding: 12px; background: transparent; border: none; color: white; outline: none; text-align: center; font-size: 0.9rem; }
        
        .add-btn {
            width: 45px; height: 45px; background: var(--royal-blue); border-radius: 12px;
            display: flex; justify-content: center; align-items: center; color: var(--gold);
            font-size: 1.5rem; cursor: pointer; border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 25px rgba(16, 28, 60, 0.2); transition: 0.3s;
        }
        .add-btn:active { transform: scale(0.9); }

        /* النافذة المنبثقة (Modal) */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 1000;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: var(--royal-blue); width: 90%; max-width: 320px; padding: 20px;
            border-radius: 20px; border: 1px solid var(--gold); position: relative;
        }
        .modal-content h3 { color: var(--gold); text-align: center; margin-top: 0; }
        .modal-content input {
            width: 100%; margin-bottom: 12px; padding: 10px; border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: white; outline: none;
        }
        .save-btn {
            width: 100%; padding: 10px; background: var(--gold); border: none;
            border-radius: 8px; color: #101c3c; font-weight: 800; cursor: pointer;
        }
        .close-modal { color: white; position: absolute; top: 10px; left: 15px; cursor: pointer; font-size: 1.2rem; }

        /* تصميم الكروت والشبكة (نفس السابق) */
        #searchResults { width: 100%; display: flex; flex-direction: column; align-items: center; gap: 15px; margin-bottom: 30px; }
        .cards-grid { display: grid; width: 100%; max-width: 1000px; gap: 8px; grid-template-columns: repeat(3, 1fr); }
        .luxury-card { position: relative; background: var(--royal-blue); border-radius: 15px; padding: 10px; overflow: hidden; display: flex; flex-direction: column; z-index: 1; }
        .luxury-card::after { content: ''; position: absolute; inset: 2px; background: var(--royal-blue); border-radius: 13px; z-index: 0; }
        .card-content { position: relative; z-index: 2; text-align: center; }
        .label { font-size: 0.5rem; color: var(--label-text); display: block; }
        .value { font-size: 0.7rem; color: #fff; font-weight: 700; display: block; margin-bottom: 3px; }
        .gold { --accent-clr: var(--gold); } .cyan { --accent-clr: var(--cyan); } .magenta { --accent-clr: var(--magenta); }
        .section-header { text-align: center; margin: 20px 0 5px; }
        .section-title { display: inline-block; color: #101c3c; font-size: 1rem; font-weight: 800; padding: 5px 15px; background: rgba(255, 255, 255, 0.3); border-radius: 20px; }
        .marquee-container { width: 100%; overflow: hidden; margin-bottom: 15px; white-space: nowrap; font-size: 0.75rem; color: #101c3c; }
        .marquee-text { display: inline-block; animation: marquee 20s linear infinite; }
        @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(100%, 0); } }
    </style>
</head>
<body>

    <div id="loader-wrapper">
        <div class="loader-spinner"></div>
        <div style="color:white; margin-top:10px;">جاري المزامنة...</div>
    </div>

    <div id="main-content">
        <div class="search-area">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="ابحث برقم السيارة أو الاسم..." onkeyup="smartSearch()">
            </div>
            <div class="add-btn" onclick="toggleModal(true)">+</div>
        </div>
        
        <div id="searchResults"></div>

        <div class="section-header">
            <div class="section-title">السيارات المسجلة: <span id="carCounter" style="color:var(--royal-blue)">0</span></div>
        </div>

        <div class="marquee-container">
            <div class="marquee-text">⚠️ قد يحدث بطيئ في البحث او الموقع بسبب زيادة عدد السيارات</div>
        </div>

        <div class="cards-grid" id="mainGrid"></div>
    </div>

    <div class="modal" id="addModal">
        <div class="modal-content">
            <span class="close-modal" onclick="toggleModal(false)">×</span>
            <h3>إضافة سيارة جديدة</h3>
            <input type="text" id="newCarNumber" placeholder="رقم السيارة">
            <input type="text" id="newOwnerName" placeholder="اسم المالك">
            <input type="text" id="newEntrance" placeholder="الجهة / الكلية">
            <button class="save-btn" onclick="addNewCar()">حفظ البيانات</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDBSiTb1m0osdrX7YOv4ADr8x-7TghSqmY",
            authDomain: "day3069-e27df.firebaseapp.com",
            databaseURL: "https://day3069-e27df-default-rtdb.firebaseio.com",
            projectId: "day3069-e27df",
            storageBucket: "day3069-e27df.firebasestorage.app",
            messagingSenderId: "110258698429",
            appId: "1:110258698429:web:fcc4114a83829756329fd4",
            measurementId: "G-Q3LN0HTXXZ"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let carsData = [];

        // جلب البيانات
        db.ref('cars').on('value', (snapshot) => {
            const data = snapshot.val();
            const mainGrid = document.getElementById('mainGrid');
            mainGrid.innerHTML = "";
            carsData = [];
            if (data) {
                document.getElementById('carCounter').innerText = Object.keys(data).length;
                const colors = ['gold', 'cyan', 'magenta'];
                let index = 0;
                for (let id in data) {
                    const car = data[id];
                    carsData.push(car);
                    mainGrid.innerHTML += `
                        <div class="luxury-card ${colors[index%3]}">
                            <div class="card-content">
                                <span class="label">رقم السيارة</span><span class="value">${car.carNumber}</span>
                                <span class="label">الاسم</span><span class="value">${car.ownerName}</span>
                                <span class="label">الجهة</span><span class="value">${car.entrance}</span>
                            </div>
                        </div>`;
                    index++;
                }
            }
            document.body.classList.add('loaded');
        });

        // وظائف النافذة المنبثقة
        function toggleModal(show) {
            document.getElementById('addModal').style.display = show ? 'flex' : 'none';
        }

        function addNewCar() {
            const num = document.getElementById('newCarNumber').value;
            const name = document.getElementById('newOwnerName').value;
            const ent = document.getElementById('newEntrance').value;

            if(num && name) {
                const newRef = db.ref('cars').push();
                newRef.set({
                    carNumber: num,
                    ownerName: name,
                    entrance: ent,
                    id: Date.now()
                }).then(() => {
                    toggleModal(false);
                    alert("تمت الإضافة بنجاح!");
                    document.getElementById('newCarNumber').value = "";
                    document.getElementById('newOwnerName').value = "";
                    document.getElementById('newEntrance').value = "";
                });
            } else {
                alert("يرجى ملء البيانات الأساسية");
            }
        }

        function smartSearch() {
            let input = document.getElementById('searchInput').value.trim().toLowerCase();
            let mainGrid = document.getElementById('mainGrid');
            let resultsDiv = document.getElementById('searchResults');
            resultsDiv.innerHTML = "";
            if (input === "") { mainGrid.style.opacity = "1"; return; }
            mainGrid.style.opacity = "0.1";
            const filtered = carsData.filter(car => 
                (car.carNumber && car.carNumber.toString().toLowerCase().includes(input)) ||
                (car.ownerName && car.ownerName.toLowerCase().includes(input))
            );
            filtered.forEach(car => {
                resultsDiv.innerHTML += `
                    <div class="luxury-card gold" style="width:75%; max-width:250px;">
                        <div class="card-content" style="padding:10px;">
                            <span class="label">رقم السيارة</span><span class="value" style="font-size:0.9rem">${car.carNumber}</span>
                            <span class="label">الاسم</span><span class="value" style="font-size:0.9rem">${car.ownerName}</span>
                            <span class="label">الجهة</span><span class="value" style="font-size:0.9rem">${car.entrance}</span>
                        </div>
                    </div>`;
            });
        }
    </script>
</body>
</html>
