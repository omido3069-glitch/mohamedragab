<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù†Ø¸Ø§Ù… Ø­Ø¶ÙˆØ± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„ÙŠÙˆÙ…ÙŠ</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
*{box-sizing:border-box;font-family:'Cairo',sans-serif;margin:0;padding:0}

body{
  background: linear-gradient(135deg,#74ebd5,#ACB6E5);
  min-height:100vh;
  padding:20px;
  color:#333;
}

.container{
  max-width:480px;
  margin:auto;
  background:rgba(255,255,255,0.15);
  backdrop-filter: blur(15px);
  border-radius:25px;
  padding:20px;
  box-shadow:0 20px 40px rgba(0,0,0,0.2);
  position:relative;
}

h1{text-align:center;margin-bottom:20px;color:#fff;font-weight:700}

input, select, button{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border:none;
  border-radius:12px;
  font-size:14px;
}

button{
  font-weight:600;
  cursor:pointer;
  color:#fff;
  background: linear-gradient(135deg,#43cea2,#185a9d);
  transition:0.3s;
}

button:hover{
  opacity:0.9;
}

/* ÙƒØ±ÙˆØª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø¨Ø³ÙŠØ·Ø© */
#cards{
  display: flex;
  flex-direction: column;
  gap:4px;
}

.card{
  background: rgba(255,255,255,0.25);
  padding:6px 10px;
  border-radius:8px;
  color:#000;
  font-weight:700;
  font-size:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

/* Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† */
.suggest-box{
  background:#fff;
  color:#333;
  border-radius:10px;
  overflow:hidden;
  display:none;
  position:relative;
  z-index:999;
  max-height:120px;
  overflow-y:auto;
  margin-bottom:10px;
}

.suggest-item{
  padding:8px 10px;
  cursor:pointer;
  border-bottom:1px solid #eee;
}

.suggest-item:last-child{
  border:none;
}

.suggest-item:hover{
  background:#f1f5ff;
}

/* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù + Ø±ÙØ¹ */
.add-upload{
  position:absolute;
  top:15px;
  left:15px;
  display:flex;
  flex-direction:column;
  gap:8px;
}

.add-btn{
  width:35px;
  height:35px;
  font-size:20px;
  background:#ffce00;
  border-radius:50%;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
  color:#000;
  font-weight:bold;
}

.upload-btn{
  width:35px;
  height:35px;
  font-size:20px;
  background:#4caf50;
  color:#fff;
  border-radius:50%;
  display:flex;
  justify-content:center;
  align-items:center;
  cursor:pointer;
}

/* ÙÙ„ØªØ±Ø© */
.filter-box{
  display:flex;
  gap:5px;
  margin-bottom:10px;
}
</style>
</head>
<body>

<div class="container">
<div class="add-upload">
  <div class="add-btn" onclick="openModal()">ï¼‹</div>
  <div class="upload-btn" onclick="uploadToFirebase()">â†‘</div>
</div>

<h1>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„ÙŠÙˆÙ…ÙŠ</h1>

<!-- ÙÙ„Ø§ØªØ± -->
<div class="filter-box">
  <select id="filterJob">
    <option value="">ÙƒÙ„ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„</option>
    <option value="Ù…ÙˆØ¸Ù">Ù…ÙˆØ¸Ù</option>
    <option value="Ø¹Ø§Ù…Ù„ Ù†Ø¸Ø§ÙØ©">Ø¹Ø§Ù…Ù„ Ù†Ø¸Ø§ÙØ©</option>
    <option value="Ù…Ù†Ø³Ù‚">Ù…Ù†Ø³Ù‚</option>
  </select>
  <input type="date" id="filterDate">
  <button onclick="applyFilter()">Ø¨Ø­Ø«</button>
</div>

<input type="text" id="empName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù" oninput="showSuggestions()">
<div class="suggest-box" id="suggest"></div>

<select id="empJob">
  <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„</option>
  <option value="Ù…ÙˆØ¸Ù">Ù…ÙˆØ¸Ù</option>
  <option value="Ø¹Ø§Ù…Ù„ Ù†Ø¸Ø§ÙØ©">Ø¹Ø§Ù…Ù„ Ù†Ø¸Ø§ÙØ©</option>
  <option value="Ù…Ù†Ø³Ù‚">Ù…Ù†Ø³Ù‚</option>
</select>

<div class="flex-row">
  <button onclick="checkIn()">âœ” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
  <button onclick="checkOut()" style="background:linear-gradient(135deg,#ff416c,#ff4b2b)">âœ– ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<h2 style="color:#fff;margin:10px 0 5px;">Ø³Ø¬Ù„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„ÙŠÙˆÙ…</h2>
<div id="cards"></div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù -->
<div class="modal" id="modal">
  <div class="modal-box">
    <h3 style="text-align:center">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</h3>
    <input type="text" id="newName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù">
    <input type="text" id="newJob" placeholder="Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ (Ù…ÙˆØ¸ÙØŒ Ø¹Ø§Ù…Ù„ Ù†Ø¸Ø§ÙØ©ØŒ Ù…Ù†Ø³Ù‚)">
    <button onclick="saveEmployee()">Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¸Ù</button>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDxZnTzssVZWtGR5iD6feE5d3BUFX3T5E0",
  authDomain: "companies-4bcc8.firebaseapp.com",
  databaseURL: "https://companies-4bcc8-default-rtdb.firebaseio.com",
  projectId: "companies-4bcc8",
  storageBucket: "companies-4bcc8.firebasestorage.app",
  messagingSenderId: "688630422572",
  appId: "1:688630422572:web:580391a664b0193383c589",
  measurementId: "G-KPHEF2BY6M"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>

<script>
// Ø§Ù„ÙˆÙ‚Øª Ø¨ØµÙŠØºØ© 12 Ø³Ø§Ø¹Ø©
function getTimeNow12(){
  const d = new Date();
  let h = d.getHours();
  const m = String(d.getMinutes()).padStart(2,'0');
  const ampm = h >= 12 ? 'PM' : 'AM';
  h = h % 12;
  h = h ? h : 12;
  return `${h}:${m} ${ampm}`;
}

// ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
function getToday(){
  const d = new Date();
  const y = d.getFullYear();
  const mo = String(d.getMonth()+1).padStart(2,'0');
  const day = String(d.getDate()).padStart(2,'0');
  return `${y}-${mo}-${day}`;
}

// ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù
function openModal(){
  document.getElementById('modal').style.display="flex";
}

// Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯
function saveEmployee(){
  const name = document.getElementById('newName').value.trim();
  const job = document.getElementById('newJob').value.trim();
  if(!name || !job){ alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆÙ†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„"); return; }

  const today = getToday();
  let localData = JSON.parse(localStorage.getItem('localEmployees') || '{}');
  if(!localData[today]) localData[today] = {};
  if(!localData[today][job]) localData[today][job] = {};
  localData[today][job][name] = {in:"-", out:"-", date:today};
  localStorage.setItem('localEmployees', JSON.stringify(localData));

  document.getElementById('modal').style.display="none";
  document.getElementById('newName').value="";
  document.getElementById('newJob').value="";
  renderCardsLocal();
}

// ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¸Ù ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
function checkIn(){
  const name = document.getElementById('empName').value.trim();
  const job = document.getElementById('empJob').value;
  if(!name || !job){ alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆÙ†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„"); return; }
  const today = getToday();
  const timeNow = getTimeNow12();

  let localData = JSON.parse(localStorage.getItem('localEmployees') || '{}');
  if(!localData[today]) localData[today] = {};
  if(!localData[today][job]) localData[today][job] = {};
  localData[today][job][name] = {in: timeNow, out:"-", date: today};
  localStorage.setItem('localEmployees', JSON.stringify(localData));
  renderCardsLocal();
}

// ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…ÙˆØ¸Ù
function checkOut(){
  const name = document.getElementById('empName').value.trim();
  const job = document.getElementById('empJob').value;
  if(!name || !job){ alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆÙ†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„"); return; }

  const today = getToday();
  let localData = JSON.parse(localStorage.getItem('localEmployees') || '{}');
  if(localData[today] && localData[today][job] && localData[today][job][name]){
    localData[today][job][name].out = getTimeNow12();
    localStorage.setItem('localEmployees', JSON.stringify(localData));
    renderCardsLocal();
  }else{
    alert("Ø§Ù„Ù…ÙˆØ¸Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©");
  }
}

// Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ±ÙˆØª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
function renderCardsLocal(){
  const cards = document.getElementById('cards');
  const today = getToday();
  let localData = JSON.parse(localStorage.getItem('localEmployees') || '{}');
  cards.innerHTML = "";

  if(localData[today]){
    for(let jobType in localData[today]){
      for(let name in localData[today][jobType]){
        const e = localData[today][jobType][name];
        cards.innerHTML += `
          <div class="card">
            <span>ğŸ‘¤ ${name}</span>
            <span>ğŸŸ¢ ${e.in || "-"} ğŸ”´ ${e.out || "-"}</span>
          </div>
        `;
      }
    }
  }
}

// Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù‰ Firebase ÙˆÙ…Ø³Ø­ Ø§Ù„Ù…Ø­Ù„ÙŠØ©
function uploadToFirebase(){
  let localData = JSON.parse(localStorage.getItem('localEmployees') || '{}');
  for(let date in localData){
    for(let jobType in localData[date]){
      for(let name in localData[date][jobType]){
        db.ref(`ØªØ³Ø¬ÙŠÙ„/${date}/${jobType}/${name}`).set(localData[date][jobType][name]);
      }
    }
  }
  localStorage.removeItem('localEmployees');
  alert("ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!");
  renderCards(); // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase Ø¨Ø¹Ø¯ Ø§Ù„Ø±ÙØ¹
}

// Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ±ÙˆØª Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Firebase (Realtime)
function renderCards(){
  const cards = document.getElementById('cards');
  const today = getToday();
  db.ref(`ØªØ³Ø¬ÙŠÙ„/${today}`).on('value', snapshot=>{
    const data = snapshot.val() || {};
    cards.innerHTML = "";
    for(let jobType in data){
      for(let name in data[jobType]){
        const e = data[jobType][name];
        cards.innerHTML += `
          <div class="card">
            <span>ğŸ‘¤ ${name}</span>
            <span>ğŸŸ¢ ${e.in || "-"} ğŸ”´ ${e.out || "-"}</span>
          </div>
        `;
      }
    }
  });
}

// Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª realtime
const suggest = document.getElementById('suggest');
document.getElementById('empName').addEventListener('input', ()=>{
  const input = document.getElementById('empName').value.toLowerCase();
  if(input === ""){ suggest.style.display="none"; return; }

  const today = getToday();
  let localData = JSON.parse(localStorage.getItem('localEmployees') || '{}');
  suggest.innerHTML = "";

  // Ø£ÙˆÙ„Ù‹Ø§ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
  if(localData[today]){
    for(let jobType in localData[today]){
      for(let name in localData[today][jobType]){
        if(name.toLowerCase().includes(input)){
          suggest.innerHTML += `<div class="suggest-item" onclick="selectEmployee('${name}','${jobType}')">ğŸ‘¤ <b>${name}</b> - ğŸ›  ${jobType}</div>`;
        }
      }
    }
  }

  // Ø¨Ø¹Ø¯ÙŠÙ† Firebase
  db.ref(`ØªØ³Ø¬ÙŠÙ„/${today}`).once('value', snapshot=>{
    const data = snapshot.val() || {};
    for(let jobType in data){
      for(let name in data[jobType]){
        if(name.toLowerCase().includes(input)){
          suggest.innerHTML += `<div class="suggest-item" onclick="selectEmployee('${name}','${jobType}')">ğŸ‘¤ <b>${name}</b> - ğŸ›  ${jobType}</div>`;
        }
      }
    }
    suggest.style.display = suggest.innerHTML ? "block" : "none";
  });
});

// Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ù† Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª
function selectEmployee(name, job){
  document.getElementById('empName').value = name;
  document.getElementById('empJob').value = job;
  suggest.style.display="none";
}

// Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡Ø§
document.addEventListener("click", e=>{
  if(!e.target.closest("#empName")){
    suggest.style.display="none";
  }
});

// ÙÙ„ØªØ±Ø©
function applyFilter(){
  const jobFilter = document.getElementById('filterJob').value;
  const dateFilter = document.getElementById('filterDate').value || getToday();
  const cards = document.getElementById('cards');
  cards.innerHTML = "";

  db.ref(`ØªØ³Ø¬ÙŠÙ„/${dateFilter}`).once('value', snapshot=>{
    const data = snapshot.val() || {};
    for(let jobType in data){
      if(jobFilter && jobFilter !== jobType) continue;
      for(let name in data[jobType]){
        const e = data[jobType][name];
        cards.innerHTML += `
          <div class="card">
            <span>ğŸ‘¤ ${name}</span>
            <span>ğŸŸ¢ ${e.in || "-"} ğŸ”´ ${e.out || "-"}</span>
          </div>
        `;
      }
    }
  });
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
renderCards();
</script>

</body>
</html>
