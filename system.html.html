<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“‹ Ù†Ø¸Ø§Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      font-family: "Cairo", sans-serif;
      background-color: #f8f9fa;
    }

    h1 {
      font-size: 2.5rem;
      font-weight: bold;
      margin: 20px 0;
      text-align: center;
    }

    /* ØªÙƒØ¨ÙŠØ± ÙˆØªØºÙ…ÙŠÙ‚ Ø§Ù„Ø®Ø· ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
    .table td {
      font-size: 1.4rem;   /* Ø­Ø¬Ù… ÙƒØ¨ÙŠØ± Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
      font-weight: bold;   /* Ø®Ø· Ø¹Ø±ÙŠØ¶ */
      color: #000;         /* Ø£Ø³ÙˆØ¯ */
      padding: 1rem;
      vertical-align: middle;
    }

    .table th {
      font-size: 1.6rem;   /* Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */
      font-weight: bold;   /* Ø¹Ø±ÙŠØ¶ */
      color: #000;
      padding: 1rem;
      text-align: center;
    }

    /* Ø§Ù„Ø¹Ø¯Ø§Ø¯ + Ø§Ù„Ù†Øµ */
    #countBox {
      font-size: 1.5rem;
      font-weight: bold;
      color: #0d6efd;
    }
    #onlineBox {
      font-size: 1.3rem;
      font-weight: bold;
      color: #198754;
    }

    /* Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
    #loadingBox {
      font-size: 1.3rem;
      font-weight: bold;
    }
  </style>
</head>
<body class="container py-4">

  <h1>ğŸ“‹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h1>

  <!-- Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª + Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div id="countBox">Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©: 0</div>
    <div id="onlineBox">ğŸŒ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø­Ø¯Ø« Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† ÙˆÙŠØ¹Ù…Ù„ Ø¨Ø¥Ù†ØªØ±Ù†Øª</div>
  </div>

  <!-- Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ­Ø±Ùƒ -->
  <div id="loadingBox" class="text-center my-3">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
    </div>
    <div class="fw-bold mt-2">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
  </div>

  <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª -->
  <div class="table-responsive">
    <table class="table table-bordered table-striped text-center align-middle">
      <thead class="table-primary">
        <tr>
          <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ</th>
          <th>Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
          <th>Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
          <th>Ø§Ù„Ø´Ø±ÙƒØ©</th>
          <th class="adminOnly">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
        </tr>
      </thead>
      <tbody id="carsTableBody">
        <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‡ØªÙŠØ¬ÙŠ Ù…Ù† Firebase -->
      </tbody>
    </table>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref, onValue, remove, update } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DATABASE_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let isAdmin = true; // Ø¹Ø¯Ù„Ù‡Ø§ Ø­Ø³Ø¨ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù†Ø¯Ùƒ

    function loadCars() {
      document.getElementById("loadingBox").style.display = "block"; // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„

      const carsRef = ref(db, "cars");
      onValue(carsRef, (snapshot) => {
        const cars = snapshot.val();
        let table = "";
        let count = 0;

        const carsArray = [];
        for (let id in cars) {
          carsArray.push({ id, ...cars[id] });
        }
        carsArray.sort((a, b) => b.timestamp - a.timestamp);

        carsArray.forEach(car => {
          count++;
          table += `
            <tr id="row-${car.id}">
              <td>${car.name}</td>
              <td>${car.number}</td>
              <td>${car.college}</td>
              <td>${car.company}</td>
              <td class="adminOnly" style="display:${isAdmin ? 'table-cell':'none'}">
                <div class="d-flex justify-content-center gap-1">
                  <button class="btn btn-sm btn-primary" onclick="editCar('${car.id}','${car.name}','${car.number}','${car.college}','${car.company}')">âœ ØªØ¹Ø¯ÙŠÙ„</button>
                  <button class="btn btn-sm btn-danger" onclick="deleteCar('${car.id}')">ğŸ—‘ Ø­Ø°Ù</button>
                </div>
              </td>
            </tr>`;
        });

        document.getElementById("carsTableBody").innerHTML = table;
        document.getElementById("countBox").innerText = "Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©: " + count;

        document.getElementById("loadingBox").style.display = "none"; // Ø¥Ø®ÙØ§Ø¡ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
      });
    }

    window.deleteCar = function(id) {
      if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø©ØŸ")) {
        remove(ref(db, "cars/" + id));
      }
    }

    window.editCar = function(id, name, number, college, company) {
      const newName = prompt("Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ:", name);
      const newNumber = prompt("Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©:", number);
      const newCollege = prompt("Ø¬Ù‡Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„:", college);
      const newCompany = prompt("Ø§Ù„Ø´Ø±ÙƒØ©:", company);

      if (newName && newNumber && newCollege && newCompany) {
        update(ref(db, "cars/" + id), {
          name: newName,
          number: newNumber,
          college: newCollege,
          company: newCompany,
          timestamp: Date.now()
        });
      }
    }

    loadCars();
  </script>
</body>
</html>
