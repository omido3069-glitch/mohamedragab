<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>📋 نظام السيارات</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      font-family: "Cairo", sans-serif;
      background-color: #f8f9fa;
    }

    h1 {
      font-size: 2.5rem;
      font-weight: bold;
      margin: 20px 0;
      text-align: center;
    }

    /* تكبير وتغميق الخط في الجدول */
    .table td {
      font-size: 1.4rem;   /* حجم كبير للبيانات */
      font-weight: bold;   /* خط عريض */
      color: #000;         /* أسود */
      padding: 1rem;
      vertical-align: middle;
    }

    .table th {
      font-size: 1.6rem;   /* أكبر من البيانات */
      font-weight: bold;   /* عريض */
      color: #000;
      padding: 1rem;
      text-align: center;
    }

    /* العداد + النص */
    #countBox {
      font-size: 1.5rem;
      font-weight: bold;
      color: #0d6efd;
    }
    #onlineBox {
      font-size: 1.3rem;
      font-weight: bold;
      color: #198754;
    }

    /* التحميل */
    #loadingBox {
      font-size: 1.3rem;
      font-weight: bold;
    }
  </style>
</head>
<body class="container py-4">

  <h1>📋 السيارات المسجلة</h1>

  <!-- عداد السيارات + رسالة الموقع -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div id="countBox">عدد السيارات الموجودة: 0</div>
    <div id="onlineBox">🌐 الموقع محدث أونلاين ويعمل بإنترنت</div>
  </div>

  <!-- التحميل المتحرك -->
  <div id="loadingBox" class="text-center my-3">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">جاري التحميل...</span>
    </div>
    <div class="fw-bold mt-2">⏳ جاري تحميل البيانات...</div>
  </div>

  <!-- جدول السيارات -->
  <div class="table-responsive">
    <table class="table table-bordered table-striped text-center align-middle">
      <thead class="table-primary">
        <tr>
          <th>اسم المالك</th>
          <th>رقم السيارة</th>
          <th>جهة الدخول</th>
          <th>الشركة</th>
          <th class="adminOnly">الإجراءات</th>
        </tr>
      </thead>
      <tbody id="carsTableBody">
        <!-- البيانات هتيجي من Firebase -->
      </tbody>
    </table>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getDatabase, ref, onValue, remove, update } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DATABASE_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let isAdmin = true; // عدلها حسب النظام عندك

    function loadCars() {
      document.getElementById("loadingBox").style.display = "block"; // إظهار التحميل

      const carsRef = ref(db, "cars");
      onValue(carsRef, (snapshot) => {
        const cars = snapshot.val();
        let table = "";
        let count = 0;

        const carsArray = [];
        for (let id in cars) {
          carsArray.push({ id, ...cars[id] });
        }
        carsArray.sort((a, b) => b.timestamp - a.timestamp);

        carsArray.forEach(car => {
          count++;
          table += `
            <tr id="row-${car.id}">
              <td>${car.name}</td>
              <td>${car.number}</td>
              <td>${car.college}</td>
              <td>${car.company}</td>
              <td class="adminOnly" style="display:${isAdmin ? 'table-cell':'none'}">
                <div class="d-flex justify-content-center gap-1">
                  <button class="btn btn-sm btn-primary" onclick="editCar('${car.id}','${car.name}','${car.number}','${car.college}','${car.company}')">✏ تعديل</button>
                  <button class="btn btn-sm btn-danger" onclick="deleteCar('${car.id}')">🗑 حذف</button>
                </div>
              </td>
            </tr>`;
        });

        document.getElementById("carsTableBody").innerHTML = table;
        document.getElementById("countBox").innerText = "عدد السيارات الموجودة: " + count;

        document.getElementById("loadingBox").style.display = "none"; // إخفاء بعد التحميل
      });
    }

    window.deleteCar = function(id) {
      if (confirm("هل أنت متأكد من حذف السيارة؟")) {
        remove(ref(db, "cars/" + id));
      }
    }

    window.editCar = function(id, name, number, college, company) {
      const newName = prompt("اسم المالك:", name);
      const newNumber = prompt("رقم السيارة:", number);
      const newCollege = prompt("جهة الدخول:", college);
      const newCompany = prompt("الشركة:", company);

      if (newName && newNumber && newCollege && newCompany) {
        update(ref(db, "cars/" + id), {
          name: newName,
          number: newNumber,
          college: newCollege,
          company: newCompany,
          timestamp: Date.now()
        });
      }
    }

    loadCars();
  </script>
</body>
</html>
